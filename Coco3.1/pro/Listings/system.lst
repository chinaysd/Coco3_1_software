C51 COMPILER V9.59.0.0   SYSTEM                                                            11/21/2018 14:47:30 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE SYSTEM
OBJECT MODULE PLACED IN .\Objects\system.obj
COMPILER INVOKED BY: E:\MDK\C51\BIN\C51.EXE ..\user\system.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\bsp;..\lib;..\TimeOut;..
                    -\user;..\bsp\key) DEBUG OBJECTEXTEND PRINT(.\Listings\system.lst) OBJECT(.\Objects\system.obj)

line level    source

   1          #include "system.h"
   2          
   3          TIMEOUT_PARA TimeOut_Para[2];
   4          unsigned char Data;
   5          
   6          extern unsigned char Uart1SendFlag,Uart1ReceiveFlag;
   7          
   8          char rev_cmp_flag = 0;
   9          extern char Rev_Flag;
  10          
  11          unsigned char Get_Key;
  12          
  13          void Key_Handle(unsigned char Key)
  14          {
  15   1          Get_Key = Key;
  16   1          if(Get_Key == MSG_KEY_NONE)
  17   1          {
  18   2            Rev_Data_Handle();  
  19   2            if(!Rev_Flag)
  20   2            {
  21   3               Data =  0;  
  22   3            }           
  23   2          }
  24   1          else if(Get_Key == MSG_KEY1_LONGPRESS)
  25   1          {
  26   2            Data =  HEAD_DOWN;
  27   2            Rev_Flag = 0;
  28   2          }
  29   1          else if(Get_Key == MSG_KEY2_LONGPRESS)
  30   1          {
  31   2            Data =  HOME_POSITION; 
  32   2            Rev_Flag = 0;        
  33   2          }
  34   1          else if(Get_Key == MSG_KEY3_LONGPRESS)
  35   1          {
  36   2            Data =  HEAD_UP; 
  37   2            Rev_Flag = 0;        
  38   2          }
  39   1          else if(Get_Key == MSG_KEY4_LONGPRESS)
  40   1          {
  41   2            Data =  LARBUM_DOWN;
  42   2            Rev_Flag = 0;        
  43   2          }
  44   1          else if(Get_Key == MSG_KEY5_LONGPRESS)
  45   1          {
  46   2            Data =  LARBUM_UP;  
  47   2            Rev_Flag = 0;        
  48   2          }
  49   1          else if(Get_Key == MSG_KEY6_LONGPRESS)
  50   1          {
  51   2            Data =  OPEN;
  52   2            Rev_Flag = 0;        
  53   2          }
  54   1          else if(Get_Key == MSG_KEY7_LONGPRESS)
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/21/2018 14:47:30 PAGE 2   

  55   1          {
  56   2            Data =  CLOSE; 
  57   2            Rev_Flag = 0;        
  58   2          }
  59   1      }
  60          
  61          void System_Init(void)
  62          {
  63   1         TimeOutDet_Init();
  64   1         Timer_Init();
  65   1         Led_App_Handle(LED_NUM);
  66   1         Key_Init();
  67   1         Key_Register(Key_Handle);
  68   1         Uart_Init(12,9600);
  69   1         #ifdef WATCH_DOG_ENABLE
  70   1         WDTCON |= 0X01; 
  71   1         #endif
  72   1         EA = 1; 
  73   1      }
  74          
  75          void System_Handle(void)
  76          {
  77   1         #ifdef WATCH_DOG_CLEAR
  78   1         WDTCON |= 0X10; 
  79   1         #endif
  80   1         P00 = 1;
  81   1         Key_Poll();   
  82   1         if(TimeOutDet_Check(&TimeOut_Para[0]))
  83   1         {
  84   2             TimeOut_Record(&TimeOut_Para[0],40);
  85   2             Protocol_Send(IC_ADDR,IC_ID,Data);
  86   2         }      
  87   1      }
  88          
  89          
  90          /**************************************************
  91          *函数名称：void timer0/1/2() interrupt 1/3/5
  92          *函数功能：定时器中断产生方波
  93          *入口参数：void
  94          *出口参数：void
  95          **************************************************/
  96          void timer0() interrupt 1
  97          {
  98   1        TL0 = (65536 - 5900)%256;
  99   1        TH0 = (65536 - 5900)/256;     
 100   1        TimeOutDet_DecHandle();  
 101   1      }
 102          
 103          void timer1() interrupt 3
 104          {
 105   1      
 106   1      }
 107          
 108          void Timer2Int(void) interrupt 5
 109          {               
 110   1              TF2 = 0;   //溢出清零
 111   1      
 112   1      }
 113          
 114          void Uart1_Int() interrupt 7   //Uart1中断函数
 115          {
 116   1      
C51 COMPILER V9.59.0.0   SYSTEM                                                            11/21/2018 14:47:30 PAGE 3   

 117   1              if(SSCON0&0x02)    //发送标志位判断
 118   1              {
 119   2                      SSCON0 &= 0xFD;
 120   2                      Uart1SendFlag = 1;
 121   2              }
 122   1              if((SSCON0&0x01))//接收标志位判断
 123   1              {
 124   2                      SSCON0 &= 0xFE;
 125   2                      Uart1ReceiveFlag = 1;
 126   2              Serial_Rev_IQH();
 127   2              }
 128   1          
 129   1      }
 130          
 131          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    340    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
